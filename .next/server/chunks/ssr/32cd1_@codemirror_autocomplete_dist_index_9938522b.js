module.exports=[851878,a=>{"use strict";a.s(["CompletionContext",()=>e,"autocompletion",()=>aw,"closeBrackets",()=>al,"closeBracketsKeymap",()=>ar,"completeFromList",()=>g,"completionKeymap",()=>ax,"ifNotIn",()=>h,"snippetCompletion",()=>af]);var b=a.i(585184),c=a.i(555669),d=a.i(27312);class e{constructor(a,b,c,d){this.state=a,this.pos=b,this.explicit=c,this.view=d,this.abortListeners=[],this.abortOnDocChange=!1}tokenBefore(a){let b=(0,d.syntaxTree)(this.state).resolveInner(this.pos,-1);for(;b&&0>a.indexOf(b.name);)b=b.parent;return b?{from:b.from,to:this.pos,text:this.state.sliceDoc(b.from,this.pos),type:b.type}:null}matchBefore(a){let b=this.state.doc.lineAt(this.pos),c=Math.max(b.from,this.pos-250),d=b.text.slice(c-b.from,this.pos-b.from),e=d.search(k(a,!1));return e<0?null:{from:c+e,to:this.pos,text:d.slice(e)}}get aborted(){return null==this.abortListeners}addEventListener(a,b,c){"abort"==a&&this.abortListeners&&(this.abortListeners.push(b),c&&c.onDocChange&&(this.abortOnDocChange=!0))}}function f(a){let b=Object.keys(a).join(""),c=/\w/.test(b);return c&&(b=b.replace(/\w/g,"")),`[${c?"\\w":""}${b.replace(/[^\w\s]/g,"\\$&")}]`}function g(a){let b=a.map(a=>"string"==typeof a?{label:a}:a),[c,d]=b.every(a=>/^\w+$/.test(a.label))?[/\w*$/,/\w+$/]:function(a){let b=Object.create(null),c=Object.create(null);for(let{label:d}of a){b[d[0]]=!0;for(let a=1;a<d.length;a++)c[d[a]]=!0}let d=f(b)+f(c)+"*$";return[RegExp("^"+d),new RegExp(d)]}(b);return a=>{let e=a.matchBefore(d);return e||a.explicit?{from:e?e.from:a.pos,options:b,validFor:c}:null}}function h(a,b){return c=>{for(let b=(0,d.syntaxTree)(c.state).resolveInner(c.pos,-1);b;b=b.parent){if(a.indexOf(b.name)>-1)return null;if(b.type.isTop)break}return b(c)}}class i{constructor(a,b,c,d){this.completion=a,this.source=b,this.match=c,this.score=d}}function j(a){return a.selection.main.from}function k(a,b){var c;let{source:d}=a,e=b&&"^"!=d[0],f="$"!=d[d.length-1];return e||f?RegExp(`${e?"^":""}(?:${d})${f?"$":""}`,null!=(c=a.flags)?c:a.ignoreCase?"i":""):a}let l=b.Annotation.define(),m=new WeakMap;function n(a){if(!Array.isArray(a))return a;let b=m.get(a);return b||m.set(a,b=g(a)),b}let o=b.StateEffect.define(),p=b.StateEffect.define();class q{constructor(a){this.pattern=a,this.chars=[],this.folded=[],this.any=[],this.precise=[],this.byWord=[],this.score=0,this.matched=[];for(let c=0;c<a.length;){let d=(0,b.codePointAt)(a,c),e=(0,b.codePointSize)(d);this.chars.push(d);let f=a.slice(c,c+e),g=f.toUpperCase();this.folded.push((0,b.codePointAt)(g==f?f.toLowerCase():g,0)),c+=e}this.astral=a.length!=this.chars.length}ret(a,b){return this.score=a,this.matched=b,this}match(a){if(0==this.pattern.length)return this.ret(-100,[]);if(a.length<this.pattern.length)return null;let{chars:c,folded:d,any:e,precise:f,byWord:g}=this;if(1==c.length){let e=(0,b.codePointAt)(a,0),f=(0,b.codePointSize)(e),g=f==a.length?0:-100;if(e==c[0]);else{if(e!=d[0])return null;g+=-200}return this.ret(g,[0,f])}let h=a.indexOf(this.pattern);if(0==h)return this.ret(a.length==this.pattern.length?0:-100,[0,this.pattern.length]);let i=c.length,j=0;if(h<0){for(let f=0,g=Math.min(a.length,200);f<g&&j<i;){let g=(0,b.codePointAt)(a,f);(g==c[j]||g==d[j])&&(e[j++]=f),f+=(0,b.codePointSize)(g)}if(j<i)return null}let k=0,l=0,m=!1,n=0,o=-1,p=-1,q=/[a-z]/.test(a),r=!0;for(let e=0,j=Math.min(a.length,200),s=0;e<j&&l<i;){let j=(0,b.codePointAt)(a,e);h<0&&(k<i&&j==c[k]&&(f[k++]=e),n<i&&(j==c[n]||j==d[n]?(0==n&&(o=e),p=e+1,n++):n=0));let t,u=j<255?j>=48&&j<=57||j>=97&&j<=122?2:+(j>=65&&j<=90):(t=(0,b.fromCodePoint)(j))!=t.toLowerCase()?1:2*(t!=t.toUpperCase());(!e||1==u&&q||0==s&&0!=u)&&(c[l]==j||d[l]==j&&(m=!0)?g[l++]=e:g.length&&(r=!1)),s=u,e+=(0,b.codePointSize)(j)}return l==i&&0==g[0]&&r?this.result(-100+(m?-200:0),g,a):n==i&&0==o?this.ret(-200-a.length+(p==a.length?0:-100),[0,p]):h>-1?this.ret(-700-a.length,[h,h+this.pattern.length]):n==i?this.ret(-900-a.length,[o,p]):l==i?this.result(-100+(m?-200:0)+-700+(r?0:-1100),g,a):2==c.length?null:this.result((e[0]?-700:0)+-200+-1100,e,a)}result(a,c,d){let e=[],f=0;for(let a of c){let c=a+(this.astral?(0,b.codePointSize)((0,b.codePointAt)(d,a)):1);f&&e[f-1]==a?e[f-1]=c:(e[f++]=a,e[f++]=c)}return this.ret(a-d.length,e)}}class r{constructor(a){this.pattern=a,this.matched=[],this.score=0,this.folded=a.toLowerCase()}match(a){if(a.length<this.pattern.length)return null;let b=a.slice(0,this.pattern.length),c=b==this.pattern?0:b.toLowerCase()==this.folded?-200:null;return null==c?null:(this.matched=[0,b.length],this.score=c+(a.length==this.pattern.length?0:-100),this)}}let s=b.Facet.define({combine:a=>(0,b.combineConfig)(a,{activateOnTyping:!0,activateOnCompletion:()=>!1,activateOnTypingDelay:100,selectOnOpen:!0,override:null,closeOnBlur:!0,maxRenderedOptions:100,defaultKeymap:!0,tooltipClass:()=>"",optionClass:()=>"",aboveCursor:!1,icons:!0,addToOptions:[],positionInfo:u,filterStrict:!1,compareCompletions:(a,b)=>a.label.localeCompare(b.label),interactionDelay:75,updateSyncTime:100},{defaultKeymap:(a,b)=>a&&b,closeOnBlur:(a,b)=>a&&b,icons:(a,b)=>a&&b,tooltipClass:(a,b)=>c=>t(a(c),b(c)),optionClass:(a,b)=>c=>t(a(c),b(c)),addToOptions:(a,b)=>a.concat(b),filterStrict:(a,b)=>a||b})});function t(a,b){return a?b?a+" "+b:a:b}function u(a,b,d,e,f,g){let h=a.textDirection==c.Direction.RTL,i=h,j=!1,k="top",l,m,n=b.left-f.left,o=f.right-b.right,p=e.right-e.left,q=e.bottom-e.top;if(i&&n<Math.min(p,o)?i=!1:!i&&o<Math.min(p,n)&&(i=!0),p<=(i?n:o))l=Math.max(f.top,Math.min(d.top,f.bottom-q))-b.top,m=Math.min(400,i?n:o);else{j=!0,m=Math.min(400,(h?b.right:f.right-b.left)-30);let a=f.bottom-b.bottom;a>=q||a>b.top?l=d.bottom-b.top:(k="bottom",l=b.bottom-d.top)}let r=(b.bottom-b.top)/g.offsetHeight,s=(b.right-b.left)/g.offsetWidth;return{style:`${k}: ${l/r}px; max-width: ${m/s}px`,class:"cm-completionInfo-"+(j?h?"left-narrow":"right-narrow":i?"left":"right")}}function v(a,b,c){if(a<=c)return{from:0,to:a};if(b<0&&(b=0),b<=a>>1){let a=Math.floor(b/c);return{from:a*c,to:(a+1)*c}}let d=Math.floor((a-b)/c);return{from:a-(d+1)*c,to:a-d*c}}class w{constructor(a,b,c){this.view=a,this.stateField=b,this.applyCompletion=c,this.info=null,this.infoDestroy=null,this.placeInfoReq={read:()=>this.measureInfo(),write:a=>this.placeInfo(a),key:this},this.space=null,this.currentClass="";let d=a.state.field(b),{options:e,selected:f}=d.open,g=a.state.facet(s);this.optionContent=function(a){let b=a.addToOptions.slice();return a.icons&&b.push({render(a){let b=document.createElement("div");return b.classList.add("cm-completionIcon"),a.type&&b.classList.add(...a.type.split(/\s+/g).map(a=>"cm-completionIcon-"+a)),b.setAttribute("aria-hidden","true"),b},position:20}),b.push({render(a,b,c,d){let e=document.createElement("span");e.className="cm-completionLabel";let f=a.displayLabel||a.label,g=0;for(let a=0;a<d.length;){let b=d[a++],c=d[a++];b>g&&e.appendChild(document.createTextNode(f.slice(g,b)));let h=e.appendChild(document.createElement("span"));h.appendChild(document.createTextNode(f.slice(b,c))),h.className="cm-completionMatchedText",g=c}return g<f.length&&e.appendChild(document.createTextNode(f.slice(g))),e},position:50},{render(a){if(!a.detail)return null;let b=document.createElement("span");return b.className="cm-completionDetail",b.textContent=a.detail,b},position:80}),b.sort((a,b)=>a.position-b.position).map(a=>a.render)}(g),this.optionClass=g.optionClass,this.tooltipClass=g.tooltipClass,this.range=v(e.length,f,g.maxRenderedOptions),this.dom=document.createElement("div"),this.dom.className="cm-tooltip-autocomplete",this.updateTooltipClass(a.state),this.dom.addEventListener("mousedown",c=>{let{options:d}=a.state.field(b).open;for(let b=c.target,e;b&&b!=this.dom;b=b.parentNode)if("LI"==b.nodeName&&(e=/-(\d+)$/.exec(b.id))&&+e[1]<d.length){this.applyCompletion(a,d[+e[1]]),c.preventDefault();return}}),this.dom.addEventListener("focusout",b=>{let c=a.state.field(this.stateField,!1);c&&c.tooltip&&a.state.facet(s).closeOnBlur&&b.relatedTarget!=a.contentDOM&&a.dispatch({effects:p.of(null)})}),this.showOptions(e,d.id)}mount(){this.updateSel()}showOptions(a,b){this.list&&this.list.remove(),this.list=this.dom.appendChild(this.createListBox(a,b,this.range)),this.list.addEventListener("scroll",()=>{this.info&&this.view.requestMeasure(this.placeInfoReq)})}update(a){var b;let c=a.state.field(this.stateField),d=a.startState.field(this.stateField);if(this.updateTooltipClass(a.state),c!=d){let{options:e,selected:f,disabled:g}=c.open;d.open&&d.open.options==e||(this.range=v(e.length,f,a.state.facet(s).maxRenderedOptions),this.showOptions(e,c.id)),this.updateSel(),g!=(null==(b=d.open)?void 0:b.disabled)&&this.dom.classList.toggle("cm-tooltip-autocomplete-disabled",!!g)}}updateTooltipClass(a){let b=this.tooltipClass(a);if(b!=this.currentClass){for(let a of this.currentClass.split(" "))a&&this.dom.classList.remove(a);for(let a of b.split(" "))a&&this.dom.classList.add(a);this.currentClass=b}}positioned(a){this.space=a,this.info&&this.view.requestMeasure(this.placeInfoReq)}updateSel(){let a=this.view.state.field(this.stateField),b=a.open;if((b.selected>-1&&b.selected<this.range.from||b.selected>=this.range.to)&&(this.range=v(b.options.length,b.selected,this.view.state.facet(s).maxRenderedOptions),this.showOptions(b.options,a.id)),this.updateSelectedOption(b.selected)){this.destroyInfo();let{completion:d}=b.options[b.selected],{info:e}=d;if(!e)return;let f="string"==typeof e?document.createTextNode(e):e(d);if(!f)return;"then"in f?f.then(b=>{b&&this.view.state.field(this.stateField,!1)==a&&this.addInfoPane(b,d)}).catch(a=>(0,c.logException)(this.view.state,a,"completion info")):this.addInfoPane(f,d)}}addInfoPane(a,b){this.destroyInfo();let c=this.info=document.createElement("div");if(c.className="cm-tooltip cm-completionInfo",null!=a.nodeType)c.appendChild(a),this.infoDestroy=null;else{let{dom:b,destroy:d}=a;c.appendChild(b),this.infoDestroy=d||null}this.dom.appendChild(c),this.view.requestMeasure(this.placeInfoReq)}updateSelectedOption(a){var b,c;let d,e,f,g=null;for(let b=this.list.firstChild,c=this.range.from;b;b=b.nextSibling,c++)"LI"==b.nodeName&&b.id?c==a?b.hasAttribute("aria-selected")||(b.setAttribute("aria-selected","true"),g=b):b.hasAttribute("aria-selected")&&b.removeAttribute("aria-selected"):c--;return g&&(b=this.list,c=g,d=b.getBoundingClientRect(),e=c.getBoundingClientRect(),f=d.height/b.offsetHeight,e.top<d.top?b.scrollTop-=(d.top-e.top)/f:e.bottom>d.bottom&&(b.scrollTop+=(e.bottom-d.bottom)/f)),g}measureInfo(){let a=this.dom.querySelector("[aria-selected]");if(!a||!this.info)return null;let b=this.dom.getBoundingClientRect(),c=this.info.getBoundingClientRect(),d=a.getBoundingClientRect(),e=this.space;if(!e){let a=this.dom.ownerDocument.documentElement;e={left:0,top:0,right:a.clientWidth,bottom:a.clientHeight}}return d.top>Math.min(e.bottom,b.bottom)-10||d.bottom<Math.max(e.top,b.top)+10?null:this.view.state.facet(s).positionInfo(this.view,b,d,c,e,this.dom)}placeInfo(a){this.info&&(a?(a.style&&(this.info.style.cssText=a.style),this.info.className="cm-tooltip cm-completionInfo "+(a.class||"")):this.info.style.cssText="top: -1e6px")}createListBox(a,b,c){let d=document.createElement("ul");d.id=b,d.setAttribute("role","listbox"),d.setAttribute("aria-expanded","true"),d.setAttribute("aria-label",this.view.state.phrase("Completions")),d.addEventListener("mousedown",a=>{a.target==d&&a.preventDefault()});let e=null;for(let f=c.from;f<c.to;f++){let{completion:g,match:h}=a[f],{section:i}=g;if(i){let a="string"==typeof i?i:i.name;a!=e&&(f>c.from||0==c.from)&&(e=a,"string"!=typeof i&&i.header?d.appendChild(i.header(i)):d.appendChild(document.createElement("completion-section")).textContent=a)}let j=d.appendChild(document.createElement("li"));j.id=b+"-"+f,j.setAttribute("role","option");let k=this.optionClass(g);for(let a of(k&&(j.className=k),this.optionContent)){let b=a(g,this.view.state,this.view,h);b&&j.appendChild(b)}}return c.from&&d.classList.add("cm-completionListIncompleteTop"),c.to<a.length&&d.classList.add("cm-completionListIncompleteBottom"),d}destroyInfo(){this.info&&(this.infoDestroy&&this.infoDestroy(),this.info.remove(),this.info=null)}destroy(){this.destroyInfo()}}function x(a){return 100*(a.boost||0)+10*!!a.apply+5*!!a.info+ +!!a.type}class y{constructor(a,b,c,d,e,f){this.options=a,this.attrs=b,this.tooltip=c,this.timestamp=d,this.selected=e,this.disabled=f}setSelected(a,b){return a==this.selected||a>=this.options.length?this:new y(this.options,C(b,a),this.tooltip,this.timestamp,a,this.disabled)}static build(a,b,c,d,e,f){if(d&&!f&&a.some(a=>a.isPending))return d.setDisabled();let g=function(a,b){let c=[],d=null,e=a=>{c.push(a);let{section:b}=a.completion;if(b){d||(d=[]);let a="string"==typeof b?b:b.name;d.some(b=>b.name==a)||d.push("string"==typeof b?{name:a}:b)}},f=b.facet(s);for(let d of a)if(d.hasResult()){let a=d.result.getMatch;if(!1===d.result.filter)for(let b of d.result.options)e(new i(b,d.source,a?a(b):[],1e9-c.length));else{let c=b.sliceDoc(d.from,d.to),g,h=f.filterStrict?new r(c):new q(c);for(let b of d.result.options)if(g=h.match(b.label)){let c=b.displayLabel?a?a(b,g.matched):[]:g.matched;e(new i(b,d.source,c,g.score+(b.boost||0)))}}}if(d){let a=Object.create(null),b=0;for(let c of d.sort((a,b)=>{var c,d;return(null!=(c=a.rank)?c:1e9)-(null!=(d=b.rank)?d:1e9)||(a.name<b.name?-1:1)}))b-=1e5,a[c.name]=b;for(let b of c){let{section:c}=b.completion;c&&(b.score+=a["string"==typeof c?c:c.name])}}let g=[],h=null,j=f.compareCompletions;for(let a of c.sort((a,b)=>b.score-a.score||j(a.completion,b.completion))){let b=a.completion;h&&h.label==b.label&&h.detail==b.detail&&(null==h.type||null==b.type||h.type==b.type)&&h.apply==b.apply&&h.boost==b.boost?x(a.completion)>x(h)&&(g[g.length-1]=a):g.push(a),h=a.completion}return g}(a,b);if(!g.length)return d&&a.some(a=>a.isPending)?d.setDisabled():null;let h=b.facet(s).selectOnOpen?0:-1;if(d&&d.selected!=h&&-1!=d.selected){let a=d.options[d.selected].completion;for(let b=0;b<g.length;b++)if(g[b].completion==a){h=b;break}}return new y(g,C(c,h),{pos:a.reduce((a,b)=>b.hasResult()?Math.min(a,b.from):a,1e8),create:L,above:e.aboveCursor},d?d.timestamp:Date.now(),h,!1)}map(a){return new y(this.options,this.attrs,{...this.tooltip,pos:a.mapPos(this.tooltip.pos)},this.timestamp,this.selected,this.disabled)}setDisabled(){return new y(this.options,this.attrs,this.tooltip,this.timestamp,this.selected,!0)}}class z{constructor(a,b,c){this.active=a,this.id=b,this.open=c}static start(){return new z(D,"cm-ac-"+Math.floor(2e6*Math.random()).toString(36),null)}update(a){let{state:b}=a,c=b.facet(s),d=(c.override||b.languageDataAt("autocomplete",j(b)).map(n)).map(b=>(this.active.find(a=>a.source==b)||new F(b,+!!this.active.some(a=>0!=a.state))).update(a,c));d.length==this.active.length&&d.every((a,b)=>a==this.active[b])&&(d=this.active);let e=this.open,f=a.effects.some(a=>a.is(H));for(let g of(e&&a.docChanged&&(e=e.map(a.changes)),a.selection||d.some(b=>b.hasResult()&&a.changes.touchesRange(b.from,b.to))||!function(a,b){if(a==b)return!0;for(let c=0,d=0;;){for(;c<a.length&&!a[c].hasResult();)c++;for(;d<b.length&&!b[d].hasResult();)d++;let e=c==a.length,f=d==b.length;if(e||f)return e==f;if(a[c++].result!=b[d++].result)return!1}}(d,this.active)||f?e=y.build(d,b,this.id,e,c,f):e&&e.disabled&&!d.some(a=>a.isPending)&&(e=null),!e&&d.every(a=>!a.isPending)&&d.some(a=>a.hasResult())&&(d=d.map(a=>a.hasResult()?new F(a.source,0):a)),a.effects))g.is(I)&&(e=e&&e.setSelected(g.value,this.id));return d==this.active&&e==this.open?this:new z(d,this.id,e)}get tooltip(){return this.open?this.open.tooltip:null}get attrs(){return this.open?this.open.attrs:this.active.length?A:B}}let A={"aria-autocomplete":"list"},B={};function C(a,b){let c={"aria-autocomplete":"list","aria-haspopup":"listbox","aria-controls":a};return b>-1&&(c["aria-activedescendant"]=a+"-"+b),c}let D=[];function E(a,b){if(a.isUserEvent("input.complete")){let c=a.annotation(l);if(c&&b.activateOnCompletion(c))return 12}let c=a.isUserEvent("input.type");return c&&b.activateOnTyping?5:c?1:a.isUserEvent("delete.backward")?2:a.selection?8:16*!!a.docChanged}class F{constructor(a,b,c=!1){this.source=a,this.state=b,this.explicit=c}hasResult(){return!1}get isPending(){return 1==this.state}update(a,b){let c=E(a,b),d=this;for(let b of((8&c||16&c&&this.touches(a))&&(d=new F(d.source,0)),4&c&&0==d.state&&(d=new F(this.source,1)),d=d.updateFor(a,c),a.effects))if(b.is(o))d=new F(d.source,1,b.value);else if(b.is(p))d=new F(d.source,0);else if(b.is(H))for(let a of b.value)a.source==d.source&&(d=a);return d}updateFor(a,b){return this.map(a.changes)}map(a){return this}touches(a){return a.changes.touchesRange(j(a.state))}}class G extends F{constructor(a,b,c,d,e,f){super(a,3,b),this.limit=c,this.result=d,this.from=e,this.to=f}hasResult(){return!0}updateFor(a,b){var c;if(!(3&b))return this.map(a.changes);let d=this.result;d.map&&!a.changes.empty&&(d=d.map(d,a.changes));let f=a.changes.mapPos(this.from),g=a.changes.mapPos(this.to,1),h=j(a.state);if(h>g||!d||2&b&&(j(a.startState)==this.from||h<this.limit))return new F(this.source,4&b?1:0);let i=a.changes.mapPos(this.limit);return!function(a,b,c,d){if(!a)return!1;let e=b.sliceDoc(c,d);return"function"==typeof a?a(e,c,d,b):k(a,!0).test(e)}(d.validFor,a.state,f,g)?d.update&&(d=d.update(d,f,g,new e(a.state,h,!1)))?new G(this.source,this.explicit,i,d,d.from,null!=(c=d.to)?c:j(a.state)):new F(this.source,1,this.explicit):new G(this.source,this.explicit,i,d,f,g)}map(a){return a.empty?this:(this.result.map?this.result.map(this.result,a):this.result)?new G(this.source,this.explicit,a.mapPos(this.limit),this.result,a.mapPos(this.from),a.mapPos(this.to,1)):new F(this.source,0)}touches(a){return a.changes.touchesRange(this.from,this.to)}}let H=b.StateEffect.define({map:(a,b)=>a.map(a=>a.map(b))}),I=b.StateEffect.define(),J=b.StateField.define({create:()=>z.start(),update:(a,b)=>a.update(b),provide:a=>[c.showTooltip.from(a,a=>a.tooltip),c.EditorView.contentAttributes.from(a,a=>a.attrs)]});function K(a,c){let d=c.completion.apply||c.completion.label,e=a.state.field(J).active.find(a=>a.source==c.source);return e instanceof G&&("string"==typeof d?a.dispatch({...function(a,c,d,e){let{main:f}=a.selection,g=d-f.from,h=e-f.from;return{...a.changeByRange(i=>{if(i!=f&&d!=e&&a.sliceDoc(i.from+g,i.from+h)!=a.sliceDoc(d,e))return{range:i};let j=a.toText(c);return{changes:{from:i.from+g,to:e==f.from?i.to:i.from+h,insert:j},range:b.EditorSelection.cursor(i.from+g+j.length)}}),scrollIntoView:!0,userEvent:"input.complete"}}(a.state,d,e.from,e.to),annotations:l.of(c.completion)}):d(a,c.completion,e.from,e.to),!0)}let L=a=>new w(a,J,K);function M(a,b="option"){return d=>{let e=d.state.field(J,!1);if(!e||!e.open||e.open.disabled||Date.now()-e.open.timestamp<d.state.facet(s).interactionDelay)return!1;let f=1,g;"page"==b&&(g=(0,c.getTooltip)(d,e.open.tooltip))&&(f=Math.max(2,Math.floor(g.dom.offsetHeight/g.dom.querySelector("li").offsetHeight)-1));let{length:h}=e.open.options,i=e.open.selected>-1?e.open.selected+f*(a?1:-1):a?0:h-1;return i<0?i="page"==b?0:h-1:i>=h&&(i="page"==b?h-1:0),d.dispatch({effects:I.of(i)}),!0}}let N=a=>!!a.state.field(J,!1)&&(a.dispatch({effects:o.of(!0)}),!0);class O{constructor(a,b){this.active=a,this.context=b,this.time=Date.now(),this.updates=[],this.done=void 0}}let P=c.ViewPlugin.fromClass(class{constructor(a){for(let b of(this.view=a,this.debounceUpdate=-1,this.running=[],this.debounceAccept=-1,this.pendingStart=!1,this.composing=0,a.state.field(J).active))b.isPending&&this.startQuery(b)}update(a){let b=a.state.field(J),d=a.state.facet(s);if(!a.selectionSet&&!a.docChanged&&a.startState.field(J)==b)return;let e=a.transactions.some(a=>{let b=E(a,d);return 8&b||(a.selection||a.docChanged)&&!(3&b)});for(let b=0;b<this.running.length;b++){let d=this.running[b];if(e||d.context.abortOnDocChange&&a.docChanged||d.updates.length+a.transactions.length>50&&Date.now()-d.time>1e3){for(let a of d.context.abortListeners)try{a()}catch(a){(0,c.logException)(this.view.state,a)}d.context.abortListeners=null,this.running.splice(b--,1)}else d.updates.push(...a.transactions)}this.debounceUpdate>-1&&clearTimeout(this.debounceUpdate),a.transactions.some(a=>a.effects.some(a=>a.is(o)))&&(this.pendingStart=!0);let f=this.pendingStart?50:d.activateOnTypingDelay;if(this.debounceUpdate=b.active.some(a=>a.isPending&&!this.running.some(b=>b.active.source==a.source))?setTimeout(()=>this.startUpdate(),f):-1,0!=this.composing)for(let b of a.transactions)b.isUserEvent("input.type")?this.composing=2:2==this.composing&&b.selection&&(this.composing=3)}startUpdate(){this.debounceUpdate=-1,this.pendingStart=!1;let{state:a}=this.view,b=a.field(J);for(let a of b.active)a.isPending&&!this.running.some(b=>b.active.source==a.source)&&this.startQuery(a);this.running.length&&b.open&&b.open.disabled&&(this.debounceAccept=setTimeout(()=>this.accept(),this.view.state.facet(s).updateSyncTime))}startQuery(a){let{state:b}=this.view,d=j(b),f=new e(b,d,a.explicit,this.view),g=new O(a,f);this.running.push(g),Promise.resolve(a.source(f)).then(a=>{g.context.aborted||(g.done=a||null,this.scheduleAccept())},a=>{this.view.dispatch({effects:p.of(null)}),(0,c.logException)(this.view.state,a)})}scheduleAccept(){this.running.every(a=>void 0!==a.done)?this.accept():this.debounceAccept<0&&(this.debounceAccept=setTimeout(()=>this.accept(),this.view.state.facet(s).updateSyncTime))}accept(){var a;this.debounceAccept>-1&&clearTimeout(this.debounceAccept),this.debounceAccept=-1;let b=[],c=this.view.state.facet(s),d=this.view.state.field(J);for(let e=0;e<this.running.length;e++){let f=this.running[e];if(void 0===f.done)continue;if(this.running.splice(e--,1),f.done){let d=j(f.updates.length?f.updates[0].startState:this.view.state),e=Math.min(d,f.done.from+ +!f.active.explicit),g=new G(f.active.source,f.active.explicit,e,f.done,f.done.from,null!=(a=f.done.to)?a:d);for(let a of f.updates)g=g.update(a,c);if(g.hasResult()){b.push(g);continue}}let g=d.active.find(a=>a.source==f.active.source);if(g&&g.isPending)if(null==f.done){let a=new F(f.active.source,0);for(let b of f.updates)a=a.update(b,c);a.isPending||b.push(a)}else this.startQuery(g)}(b.length||d.open&&d.open.disabled)&&this.view.dispatch({effects:H.of(b)})}},{eventHandlers:{blur(a){let b=this.view.state.field(J,!1);if(b&&b.tooltip&&this.view.state.facet(s).closeOnBlur){let d=b.open&&(0,c.getTooltip)(this.view,b.open.tooltip);d&&d.dom.contains(a.relatedTarget)||setTimeout(()=>this.view.dispatch({effects:p.of(null)}),10)}},compositionstart(){this.composing=1},compositionend(){3==this.composing&&setTimeout(()=>this.view.dispatch({effects:o.of(!1)}),20),this.composing=0}}}),Q="object"==typeof navigator&&/Win/.test(navigator.platform),R=b.Prec.highest(c.EditorView.domEventHandlers({keydown(a,b){let c=b.state.field(J,!1);if(!c||!c.open||c.open.disabled||c.open.selected<0||a.key.length>1||a.ctrlKey&&!(Q&&a.altKey)||a.metaKey)return!1;let d=c.open.options[c.open.selected],e=c.active.find(a=>a.source==d.source),f=d.completion.commitCharacters||e.result.commitCharacters;return f&&f.indexOf(a.key)>-1&&K(b,d),!1}})),S=c.EditorView.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",height:"100%",listStyle:"none",margin:0,padding:0,"& > li, & > completion-section":{padding:"1px 3px",lineHeight:1.2},"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer"},"& > completion-section":{display:"list-item",borderBottom:"1px solid silver",paddingLeft:"0.5em",opacity:.7}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&light .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#777"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},"&dark .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#444"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'"···"',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"400px",boxSizing:"border-box",whiteSpace:"pre-line"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},".cm-completionInfo.cm-completionInfo-left-narrow":{right:"30px"},".cm-completionInfo.cm-completionInfo-right-narrow":{left:"30px"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",display:"inline-block",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6",boxSizing:"content-box"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"'ƒ'"}},".cm-completionIcon-class":{"&:after":{content:"'○'"}},".cm-completionIcon-interface":{"&:after":{content:"'◌'"}},".cm-completionIcon-variable":{"&:after":{content:"'𝑥'"}},".cm-completionIcon-constant":{"&:after":{content:"'𝐶'"}},".cm-completionIcon-type":{"&:after":{content:"'𝑡'"}},".cm-completionIcon-enum":{"&:after":{content:"'∪'"}},".cm-completionIcon-property":{"&:after":{content:"'□'"}},".cm-completionIcon-keyword":{"&:after":{content:"'🔑︎'"}},".cm-completionIcon-namespace":{"&:after":{content:"'▢'"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}});class T{constructor(a,b,c,d){this.field=a,this.line=b,this.from=c,this.to=d}}class U{constructor(a,b,c){this.field=a,this.from=b,this.to=c}map(a){let c=a.mapPos(this.from,-1,b.MapMode.TrackDel),d=a.mapPos(this.to,1,b.MapMode.TrackDel);return null==c||null==d?null:new U(this.field,c,d)}}class V{constructor(a,b){this.lines=a,this.fieldPositions=b}instantiate(a,b){let c=[],e=[b],f=a.doc.lineAt(b),g=/^\s*/.exec(f.text)[0];for(let f of this.lines){if(c.length){let c=g,h=/^\t*/.exec(f)[0].length;for(let b=0;b<h;b++)c+=a.facet(d.indentUnit);e.push(b+c.length-h),f=c+f.slice(h)}c.push(f),b+=f.length+1}return{text:c,ranges:this.fieldPositions.map(a=>new U(a.field,e[a.line]+a.from,e[a.line]+a.to))}}static parse(a){let b=[],c=[],d=[],e;for(let f of a.split(/\r\n?|\n/)){for(;e=/[#$]\{(?:(\d+)(?::([^{}]*))?|((?:\\[{}]|[^{}])*))\}/.exec(f);){let a=e[1]?+e[1]:null,g=e[2]||e[3]||"",h=-1,i=g.replace(/\\[{}]/g,a=>a[1]);for(let c=0;c<b.length;c++)(null!=a?b[c].seq==a:i&&b[c].name==i)&&(h=c);if(h<0){let c=0;for(;c<b.length&&(null==a||null!=b[c].seq&&b[c].seq<a);)c++;for(let e of(b.splice(c,0,{seq:a,name:i}),h=c,d))e.field>=h&&e.field++}for(let a of d)if(a.line==c.length&&a.from>e.index){let b=e[2]?3+(e[1]||"").length:2;a.from-=b,a.to-=b}d.push(new T(h,c.length,e.index,e.index+i.length)),f=f.slice(0,e.index)+g+f.slice(e.index+e[0].length)}f=f.replace(/\\([{}])/g,(a,b,e)=>{for(let a of d)a.line==c.length&&a.from>e&&(a.from--,a.to--);return b}),c.push(f)}return new V(c,d)}}let W=c.Decoration.widget({widget:new class extends c.WidgetType{toDOM(){let a=document.createElement("span");return a.className="cm-snippetFieldPosition",a}ignoreEvent(){return!1}}}),X=c.Decoration.mark({class:"cm-snippetField"});class Y{constructor(a,b){this.ranges=a,this.active=b,this.deco=c.Decoration.set(a.map(a=>(a.from==a.to?W:X).range(a.from,a.to)),!0)}map(a){let b=[];for(let c of this.ranges){let d=c.map(a);if(!d)return null;b.push(d)}return new Y(b,this.active)}selectionInsideField(a){return a.ranges.every(a=>this.ranges.some(b=>b.field==this.active&&b.from<=a.from&&b.to>=a.to))}}let Z=b.StateEffect.define({map:(a,b)=>a&&a.map(b)}),$=b.StateEffect.define(),_=b.StateField.define({create:()=>null,update(a,b){for(let c of b.effects){if(c.is(Z))return c.value;if(c.is($)&&a)return new Y(a.ranges,c.value)}return a&&b.docChanged&&(a=a.map(b.changes)),a&&b.selection&&!a.selectionInsideField(b.selection)&&(a=null),a},provide:a=>c.EditorView.decorations.from(a,a=>a?a.deco:c.Decoration.none)});function aa(a,c){return b.EditorSelection.create(a.filter(a=>a.field==c).map(a=>b.EditorSelection.range(a.from,a.to)))}function ab(a){return({state:b,dispatch:c})=>{let d=b.field(_,!1);if(!d||a<0&&0==d.active)return!1;let e=d.active+a,f=a>0&&!d.ranges.some(b=>b.field==e+a);return c(b.update({selection:aa(d.ranges,e),effects:Z.of(f?null:new Y(d.ranges,e)),scrollIntoView:!0})),!0}}let ac=[{key:"Tab",run:ab(1),shift:ab(-1)},{key:"Escape",run:({state:a,dispatch:b})=>!!a.field(_,!1)&&(b(a.update({effects:Z.of(null)})),!0)}],ad=b.Facet.define({combine:a=>a.length?a[0]:ac}),ae=b.Prec.highest(c.keymap.compute([ad],a=>a.facet(ad)));function af(a,c){let d;return{...c,apply:(d=V.parse(a),(a,c,e,f)=>{let{text:g,ranges:h}=d.instantiate(a.state,e),{main:i}=a.state.selection,j={changes:{from:e,to:f==i.from?i.to:f,insert:b.Text.of(g)},scrollIntoView:!0,annotations:c?[l.of(c),b.Transaction.userEvent.of("input.complete")]:void 0};if(h.length&&(j.selection=aa(h,0)),h.some(a=>a.field>0)){let c=new Y(h,0),d=j.effects=[Z.of(c)];void 0===a.state.field(_,!1)&&d.push(b.StateEffect.appendConfig.of([_,ae,ag,S]))}a.dispatch(a.state.update(j))})}}let ag=c.EditorView.domEventHandlers({mousedown(a,b){let c=b.state.field(_,!1),d;if(!c||null==(d=b.posAtCoords({x:a.clientX,y:a.clientY})))return!1;let e=c.ranges.find(a=>a.from<=d&&a.to>=d);return!!e&&e.field!=c.active&&(b.dispatch({selection:aa(c.ranges,e.field),effects:Z.of(c.ranges.some(a=>a.field>e.field)?new Y(c.ranges,e.field):null),scrollIntoView:!0}),!0)}}),ah={brackets:["(","[","{","'",'"'],before:")]}:;>",stringPrefixes:[]},ai=b.StateEffect.define({map(a,c){let d=c.mapPos(a,-1,b.MapMode.TrackAfter);return null==d?void 0:d}}),aj=new class extends b.RangeValue{};aj.startSide=1,aj.endSide=-1;let ak=b.StateField.define({create:()=>b.RangeSet.empty,update(a,b){if(a=a.map(b.changes),b.selection){let c=b.state.doc.lineAt(b.selection.main.head);a=a.update({filter:a=>a>=c.from&&a<=c.to})}for(let c of b.effects)c.is(ai)&&(a=a.update({add:[aj.range(c.value,c.value+1)]}));return a}});function al(){return[aq,ak]}let am="()[]{}<>«»»«［］｛｝";function an(a){for(let b=0;b<am.length;b+=2)if(am.charCodeAt(b)==a)return am.charAt(b+1);return(0,b.fromCodePoint)(a<128?a:a+1)}function ao(a,b){return a.languageDataAt("closeBrackets",b)[0]||ah}let ap="object"==typeof navigator&&/Android\b/.test(navigator.userAgent),aq=c.EditorView.inputHandler.of((a,c,e,f)=>{if((ap?a.composing:a.compositionStarted)||a.state.readOnly)return!1;let g=a.state.selection.main;if(f.length>2||2==f.length&&1==(0,b.codePointSize)((0,b.codePointAt)(f,0))||c!=g.from||e!=g.to)return!1;let h=function(a,c){let e=ao(a,a.selection.main.head),f=e.brackets||ah.brackets;for(let g of f){let h=an((0,b.codePointAt)(g,0));if(c==g)return h==g?function(a,c,e,f){let g=f.stringPrefixes||ah.stringPrefixes,h=null,i=a.changeByRange(f=>{if(!f.empty)return{changes:[{insert:c,from:f.from},{insert:c,from:f.to}],effects:ai.of(f.to+c.length),range:b.EditorSelection.range(f.anchor+c.length,f.head+c.length)};let i=f.head,j=at(a.doc,i),k;if(j==c){if(au(a,i))return{changes:{insert:c+c,from:i},effects:ai.of(i+c.length),range:b.EditorSelection.cursor(i+c.length)};else if(as(a,i)){let d=e&&a.sliceDoc(i,i+3*c.length)==c+c+c?c+c+c:c;return{changes:{from:i,to:i+d.length,insert:d},range:b.EditorSelection.cursor(i+d.length)}}}else if(e&&a.sliceDoc(i-2*c.length,i)==c+c&&(k=av(a,i-2*c.length,g))>-1&&au(a,k))return{changes:{insert:c+c+c+c,from:i},effects:ai.of(i+c.length),range:b.EditorSelection.cursor(i+c.length)};else if(a.charCategorizer(i)(j)!=b.CharCategory.Word&&av(a,i,g)>-1&&!function(a,b,c,e){let f=(0,d.syntaxTree)(a).resolveInner(b,-1),g=e.reduce((a,b)=>Math.max(a,b.length),0);for(let d=0;d<5;d++){let d=a.sliceDoc(f.from,Math.min(f.to,f.from+c.length+g)),h=d.indexOf(c);if(!h||h>-1&&e.indexOf(d.slice(0,h))>-1){let b=f.firstChild;for(;b&&b.from==f.from&&b.to-b.from>c.length+h;){if(a.sliceDoc(b.to-c.length,b.to)==c)return!1;b=b.firstChild}return!0}let i=f.to==b&&f.parent;if(!i)break;f=i}return!1}(a,i,c,g))return{changes:{insert:c+c,from:i},effects:ai.of(i+c.length),range:b.EditorSelection.cursor(i+c.length)};return{range:h=f}});return h?null:a.update(i,{scrollIntoView:!0,userEvent:"input.type"})}(a,g,f.indexOf(g+g+g)>-1,e):function(a,c,d,e){let f=null,g=a.changeByRange(g=>{if(!g.empty)return{changes:[{insert:c,from:g.from},{insert:d,from:g.to}],effects:ai.of(g.to+c.length),range:b.EditorSelection.range(g.anchor+c.length,g.head+c.length)};let h=at(a.doc,g.head);return!h||/\s/.test(h)||e.indexOf(h)>-1?{changes:{insert:c+d,from:g.head},effects:ai.of(g.head+c.length),range:b.EditorSelection.cursor(g.head+c.length)}:{range:f=g}});return f?null:a.update(g,{scrollIntoView:!0,userEvent:"input.type"})}(a,g,h,e.before||ah.before);if(c==h&&as(a,a.selection.main.from))return function(a,c,d){let e=null,f=a.changeByRange(c=>c.empty&&at(a.doc,c.head)==d?{changes:{from:c.head,to:c.head+d.length,insert:d},range:b.EditorSelection.cursor(c.head+d.length)}:e={range:c});return e?null:a.update(f,{scrollIntoView:!0,userEvent:"input.type"})}(a,0,h)}return null}(a.state,f);return!!h&&(a.dispatch(h),!0)}),ar=[{key:"Backspace",run:({state:a,dispatch:c})=>{if(a.readOnly)return!1;let d=ao(a,a.selection.main.head).brackets||ah.brackets,e=null,f=a.changeByRange(c=>{if(c.empty){let e=function(a,c){let d=a.sliceString(c-2,c);return(0,b.codePointSize)((0,b.codePointAt)(d,0))==d.length?d:d.slice(1)}(a.doc,c.head);for(let f of d)if(f==e&&at(a.doc,c.head)==an((0,b.codePointAt)(f,0)))return{changes:{from:c.head-f.length,to:c.head+f.length},range:b.EditorSelection.cursor(c.head-f.length)}}return{range:e=c}});return e||c(a.update(f,{scrollIntoView:!0,userEvent:"delete.backward"})),!e}}];function as(a,b){let c=!1;return a.field(ak).between(0,a.doc.length,a=>{a==b&&(c=!0)}),c}function at(a,c){let d=a.sliceString(c,c+2);return d.slice(0,(0,b.codePointSize)((0,b.codePointAt)(d,0)))}function au(a,b){let c=(0,d.syntaxTree)(a).resolveInner(b+1);return c.parent&&c.from==b}function av(a,c,d){let e=a.charCategorizer(c);if(e(a.sliceDoc(c-1,c))!=b.CharCategory.Word)return c;for(let f of d){let d=c-f.length;if(a.sliceDoc(d,c)==f&&e(a.sliceDoc(d-1,d))!=b.CharCategory.Word)return d}return -1}function aw(a={}){return[R,J,s.of(a),P,ay,S]}let ax=[{key:"Ctrl-Space",run:N},{mac:"Alt-`",run:N},{mac:"Alt-i",run:N},{key:"Escape",run:a=>{let b=a.state.field(J,!1);return!!b&&!!b.active.some(a=>0!=a.state)&&(a.dispatch({effects:p.of(null)}),!0)}},{key:"ArrowDown",run:M(!0)},{key:"ArrowUp",run:M(!1)},{key:"PageDown",run:M(!0,"page")},{key:"PageUp",run:M(!1,"page")},{key:"Enter",run:a=>{let b=a.state.field(J,!1);return!(a.state.readOnly||!b||!b.open||b.open.selected<0||b.open.disabled||Date.now()-b.open.timestamp<a.state.facet(s).interactionDelay)&&K(a,b.open.options[b.open.selected])}}],ay=b.Prec.highest(c.keymap.computeN([s],a=>a.facet(s).defaultKeymap?[ax]:[]))}];

//# sourceMappingURL=32cd1_%40codemirror_autocomplete_dist_index_9938522b.js.map